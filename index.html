<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Event Scheduler</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js">
  <style>
    :root {
      --background: 0 0% 100%;
      --foreground: 222.2 84% 4.9%;
      --card: 0 0% 100%;
      --card-foreground: 222.2 84% 4.9%;
      --popover: 0 0% 100%;
      --popover-foreground: 222.2 84% 4.9%;
      --primary: 221.2 83.2% 53.3%;
      --primary-foreground: 210 40% 98%;
      --secondary: 210 40% 96.1%;
      --secondary-foreground: 222.2 47.4% 11.2%;
      --muted: 210 40% 96.1%;
      --muted-foreground: 215.4 16.3% 46.9%;
      --accent: 210 40% 96.1%;
      --accent-foreground: 222.2 47.4% 11.2%;
      --destructive: 0 84.2% 60.2%;
      --destructive-foreground: 210 40% 98%;
      --border: 214.3 31.8% 91.4%;
      --input: 214.3 31.8% 91.4%;
      --ring: 221.2 83.2% 53.3%;
      --radius: 0.5rem;
    }

    .dark {
      --background: 222.2 84% 4.9%;
      --foreground: 210 40% 98%;
      --card: 222.2 84% 4.9%;
      --card-foreground: 210 40% 98%;
      --popover: 222.2 84% 4.9%;
      --popover-foreground: 210 40% 98%;
      --primary: 217.2 91.2% 59.8%;
      --primary-foreground: 222.2 47.4% 11.2%;
      --secondary: 217.2 32.6% 17.5%;
      --secondary-foreground: 210 40% 98%;
      --muted: 217.2 32.6% 17.5%;
      --muted-foreground: 215 20.2% 65.1%;
      --accent: 217.2 32.6% 17.5%;
      --accent-foreground: 210 40% 98%;
      --destructive: 0 62.8% 30.6%;
      --destructive-foreground: 210 40% 98%;
      --border: 217.2 32.6% 17.5%;
      --input: 217.2 32.6% 17.5%;
      --ring: 224.3 76.3% 48%;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }

    body {
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      transition: background-color 0.2s, color 0.2s;
      min-height: 100vh;
      padding: 0;
    }

    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
    }

    .main-content {
      flex: 1;
      padding: 1rem;
      transition: margin 0.3s ease;
    }

    .sidebar {
      width: 100%;
      background-color: hsl(var(--card));
      border-top: 1px solid hsl(var(--border));
      padding: 1rem;
      overflow-y: auto;
      transition: transform 0.3s ease, opacity 0.3s ease;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 50vh;
      transform: translateY(100%);
      z-index: 100;
    }

    .sidebar.active {
      transform: translateY(0);
    }

    .sidebar h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .chart-container {
      position: relative;
      height: 200px;
      margin-bottom: 1.5rem;
    }

    .upcoming-events {
      margin-top: 1.5rem;
    }

    .upcoming-event {
      padding: 0.75rem;
      border-radius: var(--radius);
      background-color: hsl(var(--secondary));
      margin-bottom: 0.75rem;
      border: 1px solid hsl(var(--border));
    }

    .upcoming-event h3 {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .upcoming-event p {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .notification-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .notification {
      padding: 0.75rem 1rem;
      border-radius: var(--radius);
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      border: 1px solid hsl(var(--border));
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      max-width: calc(100vw - 2rem);
      transform: translateX(120%);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.reminder {
      background-color: hsl(221.2 83.2% 53.3% / 0.1);
      border-color: hsl(221.2 83.2% 53.3% / 0.2);
    }

    .notification.success {
      background-color: hsl(142.1 76.2% 36.3% / 0.1);
      border-color: hsl(142.1 76.2% 36.3% / 0.2);
    }

    .notification.error {
      background-color: hsl(0 84.2% 60.2% / 0.1);
      border-color: hsl(0 84.2% 60.2% / 0.2);
    }

    .notification-icon {
      flex-shrink: 0;
    }

    .notification-content {
      flex: 1;
    }

    .notification-title {
      font-weight: 500;
      font-size: 0.875rem;
      margin-bottom: 0.25rem;
    }

    .notification-message {
      font-size: 0.75rem;
      color: hsl(var(--muted-foreground));
    }

    .notification-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .notification-actions button {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .notification-close {
      background: none;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      padding: 0.25rem;
      border-radius: var(--radius);
    }

    .notification-close:hover {
      background-color: hsl(var(--muted) / 0.5);
    }

    header {
      padding: 1rem 0;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    h1 {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
    }

    button {
      padding: 0.5rem;
      border-radius: var(--radius);
      border: 1px solid hsl(var(--border));
      cursor: pointer;
      font-weight: 500;
      font-size: 0.875rem;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      flex: 1;
      min-width: 120px;
      justify-content: center;
    }

    .btn-primary {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      border-color: hsl(var(--primary));
    }

    .btn-primary:hover {
      background-color: hsl(var(--primary) / 0.9);
    }

    .btn-outline {
      background-color: transparent;
      color: hsl(var(--foreground));
      border-color: hsl(var(--border));
    }

    .btn-outline:hover {
      background-color: hsl(var(--secondary));
    }

    .btn-danger {
      background-color: hsl(var(--destructive));
      color: hsl(var(--destructive-foreground));
      border-color: hsl(var(--destructive));
    }

    .btn-danger:hover {
      background-color: hsl(var(--destructive) / 0.9);
    }

    .btn-ghost {
      background-color: transparent;
      border-color: transparent;
      color: hsl(var(--foreground));
    }

    .btn-ghost:hover {
      background-color: hsl(var(--secondary));
    }

    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .calendar-header {
      display: none;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      padding: 0.75rem 0;
      font-weight: 500;
      font-size: 0.875rem;
      color: hsl(var(--muted-foreground));
      border-bottom: 1px solid hsl(var(--border));
    }

    .calendar-body {
      display: grid;
      grid-template-columns: 1fr;
      grid-auto-rows: 1fr;
      min-height: auto;
      gap: 0.5rem;
    }

    .calendar-day {
      padding: 0.5rem;
      border: 1px solid hsl(var(--border));
      position: relative;
      background-color: hsl(var(--card));
      min-height: 120px;
    }

    .today .day-number {
      color: hsl(var(--primary));
      font-weight: 600;
    }

    .today {
      background-color: hsl(var(--primary) / 0.05);
    }

    .today-badge {
      background-color: hsl(var(--primary));
      color: hsl(var(--primary-foreground));
      font-size: 0.75rem;
      padding: 0.125rem 0.25rem;
      border-radius: var(--radius);
      margin-left: 0.25rem;
    }

    .events-container {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.375rem;
    }

    .event {
      background-color: hsl(var(--primary) / 0.1);
      border: 1px solid hsl(var(--primary) / 0.2);
      padding: 0.375rem;
      border-radius: calc(var(--radius) - 2px);
      font-size: 0.75rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .event:hover {
      background-color: hsl(var(--primary) / 0.2);
    }

    .event-title {
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .event-details {
      font-size: 0.6875rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      color: hsl(var(--muted-foreground));
    }

    .event-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.25rem;
      margin-top: 0.25rem;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: hsl(var(--background) / 0.8);
      backdrop-filter: blur(4px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background-color: hsl(var(--card));
      width: 95%;
      max-width: 500px;
      border-radius: var(--radius);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      border: 1px solid hsl(var(--border));
      transform: translateY(-20px);
      transition: transform 0.3s ease;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 1rem;
      border-bottom: 1px solid hsl(var(--border));
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background-color: hsl(var(--card));
      z-index: 10;
    }

    .modal-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.25rem;
      cursor: pointer;
      color: hsl(var(--muted-foreground));
      padding: 0.25rem;
      border-radius: var(--radius);
    }

    .modal-close:hover {
      background-color: hsl(var(--muted));
    }

    .modal-body {
      padding: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      font-size: 0.875rem;
    }

    input, textarea, select {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid hsl(var(--input));
      border-radius: var(--radius);
      background-color: hsl(var(--background));
      color: hsl(var(--foreground));
      font-size: 0.875rem;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: hsl(var(--primary));
      box-shadow: 0 0 0 2px hsl(var(--primary) / 0.2);
    }

    textarea {
      min-height: 100px;
    }

    .form-row {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .form-row .form-group {
      flex: 1;
    }

    .modal-footer {
      padding: 1rem;
      border-top: 1px solid hsl(var(--border));
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      position: sticky;
      bottom: 0;
      background-color: hsl(var(--card));
    }

    .theme-toggle {
      background: none;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .theme-toggle:hover {
      background-color: hsl(var(--muted));
    }

    .sidebar-toggle {
      display: flex;
      background: none;
      border: none;
      color: hsl(var(--muted-foreground));
      cursor: pointer;
      padding: 0.5rem;
      border-radius: var(--radius);
      margin-left: auto;
    }

    .sidebar-toggle:hover {
      background-color: hsl(var(--muted));
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 99;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    @media (min-width: 640px) {
      .calendar-header {
        display: grid;
      }

      .calendar-body {
        grid-template-columns: repeat(7, 1fr);
        min-height: 500px;
        gap: 0;
      }

      .calendar-day {
        min-height: auto;
        border-right: 1px solid hsl(var(--border));
        border-bottom: 1px solid hsl(var(--border));
      }

      .calendar-day:nth-child(7n) {
        border-right: none;
      }

      .form-row {
        flex-direction: row;
      }

      button {
        flex: 0 1 auto;
        padding: 0.5rem 1rem;
      }
    }

    @media (min-width: 768px) {
      .container {
        flex-direction: row;
      }

      .main-content {
        padding: 1.5rem;
      }

      .sidebar {
        position: relative;
        width: 350px;
        height: auto;
        border-top: none;
        border-left: 1px solid hsl(var(--border));
        transform: none;
        padding: 1.5rem;
      }

      .sidebar-toggle {
        display: none;
      }

      .overlay {
        display: none;
      }

      header {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
      }

      h1 {
        font-size: 1.5rem;
      }

      .controls {
        flex-wrap: nowrap;
      }
    }

    svg {
      width: 1rem;
      height: 1rem;
    }

    /* Audio element for notification sounds */
    #notification-sound {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="main-content">
      <header>
        <h1>Campus Event Scheduler</h1>
        <div class="controls">
          <button class="btn-outline" id="prev-week">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            <span class="btn-text">Previous</span>
          </button>
          <button class="btn-outline" id="today">Today</button>
          <button class="btn-outline" id="next-week">
            <span class="btn-text">Next</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
          <button class="btn-primary" id="add-event">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span class="btn-text">Add Event</span>
          </button>
          <button class="sidebar-toggle" id="sidebar-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <button class="theme-toggle" id="theme-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg>
          </button>
        </div>
      </header>

      <div class="calendar-header">
        <div>Sunday</div>
        <div>Monday</div>
        <div>Tuesday</div>
        <div>Wednesday</div>
        <div>Thursday</div>
        <div>Friday</div>
        <div>Saturday</div>
      </div>

      <div class="calendar-body" id="calendar-body">
        <!-- Calendar days will be populated by JavaScript -->
      </div>
    </div>

    <div class="sidebar" id="sidebar">
      <h2>Events Overview</h2>
      <div class="chart-container">
        <canvas id="events-chart"></canvas>
      </div>
      
      <div class="upcoming-events">
        <h2>Upcoming Events</h2>
        <div id="upcoming-events-list">
          <!-- Upcoming events will be populated by JavaScript -->
        </div>
      </div>
    </div>
    <div class="overlay" id="sidebar-overlay"></div>
  </div>

  <!-- Event Modal -->
  <div class="modal" id="event-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Add New Event</h2>
        <button class="modal-close" id="modal-close">&times;</button>
      </div>
      <form id="event-form">
        <div class="modal-body">
          <input type="hidden" id="event-id">
          <div class="form-group">
            <label for="event-title">Title</label>
            <input type="text" id="event-title" required>
          </div>
          <div class="form-group">
            <label for="event-description">Description</label>
            <textarea id="event-description"></textarea>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="event-date">Date</label>
              <input type="date" id="event-date" required>
            </div>
            <div class="form-group">
              <label for="event-time">Time</label>
              <input type="time" id="event-time" required>
            </div>
          </div>
          <div class="form-group">
            <label for="event-location">Location</label>
            <input type="text" id="event-location" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-outline" id="cancel-btn">Cancel</button>
          <button type="submit" class="btn-primary" id="save-btn">Save Event</button>
          <button type="button" class="btn-danger" id="delete-btn">Delete Event</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Notification Container -->
  <div class="notification-container" id="notification-container">
    <!-- Notifications will be added here dynamically -->
  </div>

  <!-- Notification sound (hidden) -->
  <audio id="notification-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // DOM Elements
      const calendarBody = document.getElementById('calendar-body');
      const prevWeekBtn = document.getElementById('prev-week');
      const nextWeekBtn = document.getElementById('next-week');
      const todayBtn = document.getElementById('today');
      const addEventBtn = document.getElementById('add-event');
      const eventModal = document.getElementById('event-modal');
      const modalCloseBtn = document.getElementById('modal-close');
      const cancelBtn = document.getElementById('cancel-btn');
      const eventForm = document.getElementById('event-form');
      const saveBtn = document.getElementById('save-btn');
      const deleteBtn = document.getElementById('delete-btn');
      const modalTitle = document.getElementById('modal-title');
      const eventIdInput = document.getElementById('event-id');
      const eventTitleInput = document.getElementById('event-title');
      const eventDescriptionInput = document.getElementById('event-description');
      const eventDateInput = document.getElementById('event-date');
      const eventTimeInput = document.getElementById('event-time');
      const eventLocationInput = document.getElementById('event-location');
      const themeToggle = document.getElementById('theme-toggle');
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebarOverlay = document.getElementById('sidebar-overlay');
      const upcomingEventsList = document.getElementById('upcoming-events-list');
      const notificationContainer = document.getElementById('notification-container');
      const notificationSound = document.getElementById('notification-sound');
      const eventsChartCtx = document.getElementById('events-chart').getContext('2d');

      // State
      let currentDate = new Date();
      let events = JSON.parse(localStorage.getItem('events')) || [
        {
          id: '1',
          title: 'Orientation Day',
          description: 'Welcome event for new students',
          date: formatDate(new Date(new Date().setDate(new Date().getDate() + 1))),
          time: '09:00',
          location: 'Main Auditorium',
          notified: false
        },
        {
          id: '2',
          title: 'Faculty Meeting',
          description: 'Monthly faculty gathering',
          date: formatDate(new Date(new Date().setDate(new Date().getDate() + 3))),
          time: '14:00',
          location: 'Conference Room A',
          notified: false
        },
        {
          id: '3',
          title: 'Career Fair',
          description: 'Annual career fair with top companies',
          date: formatDate(new Date(new Date().setDate(new Date().getDate() + 7))),
          time: '10:00',
          location: 'Student Center',
          notified: false
        },
        {
          id: '4',
          title: 'Alumni Reunion',
          description: 'Reunion for class of 2010',
          date: formatDate(new Date(new Date().setDate(new Date().getDate() + 10))),
          time: '18:00',
          location: 'Alumni Hall',
          notified: false
        }
      ];
      let eventsChart;
      let notificationCheckInterval;

      // Initialize
      renderCalendar();
      renderUpcomingEvents();
      initChart();
      checkThemePreference();
      startNotificationChecker();

      // Event Listeners
      prevWeekBtn.addEventListener('click', () => {
        currentDate.setDate(currentDate.getDate() - 7);
        renderCalendar();
      });

      nextWeekBtn.addEventListener('click', () => {
        currentDate.setDate(currentDate.getDate() + 7);
        renderCalendar();
      });

      todayBtn.addEventListener('click', () => {
        currentDate = new Date();
        renderCalendar();
        showNotification('Calendar reset to current week', 'success');
      });

      addEventBtn.addEventListener('click', () => {
        openModal();
      });

      modalCloseBtn.addEventListener('click', closeModal);
      cancelBtn.addEventListener('click', closeModal);

      eventForm.addEventListener('submit', function(e) {
        e.preventDefault();
        saveEvent();
      });

      deleteBtn.addEventListener('click', deleteEvent);

      themeToggle.addEventListener('click', toggleTheme);

      sidebarToggle.addEventListener('click', toggleSidebar);
      sidebarOverlay.addEventListener('click', toggleSidebar);

      // Functions
      function renderCalendar() {
        calendarBody.innerHTML = '';
        
        const weekStart = new Date(currentDate);
        weekStart.setDate(currentDate.getDate() - currentDate.getDay());
        
        for (let i = 0; i < 7; i++) {
          const day = new Date(weekStart);
          day.setDate(weekStart.getDate() + i);
          
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-day';
          
          if (isSameDay(day, new Date())) {
            dayElement.classList.add('today');
          }
          
          const dayNumber = document.createElement('div');
          dayNumber.className = 'day-number';
          dayNumber.textContent = day.getDate();
          
          if (isSameDay(day, new Date())) {
            const todayBadge = document.createElement('span');
            todayBadge.className = 'today-badge';
            todayBadge.textContent = 'Today';
            dayNumber.appendChild(todayBadge);
          }
          
          dayElement.appendChild(dayNumber);
          
          const eventsContainer = document.createElement('div');
          eventsContainer.className = 'events-container';
          
          const dayEvents = getEventsForDay(day);
          dayEvents.forEach(event => {
            const eventElement = document.createElement('div');
            eventElement.className = 'event';
            eventElement.dataset.id = event.id;
            
            const eventTitle = document.createElement('div');
            eventTitle.className = 'event-title';
            eventTitle.textContent = event.title;
            
            const eventDetails = document.createElement('div');
            eventDetails.className = 'event-details';
            
            const timeIcon = document.createElement('span');
            timeIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>';
            
            const timeText = document.createElement('span');
            timeText.textContent = event.time;
            
            const locationText = document.createElement('span');
            locationText.textContent = event.location;
            
            eventDetails.appendChild(timeIcon);
            eventDetails.appendChild(timeText);
            eventDetails.appendChild(document.createTextNode(' • '));
            eventDetails.appendChild(locationText);
            
            const eventActions = document.createElement('div');
            eventActions.className = 'event-actions';
            
            const editBtn = document.createElement('button');
            editBtn.className = 'btn-outline btn-sm';
            editBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>';
            editBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              editEvent(event.id);
            });
            
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'btn-danger btn-sm';
            deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>';
            deleteBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              if (confirm('Are you sure you want to delete this event?')) {
                deleteEvent(event.id);
              }
            });
            
            eventActions.appendChild(editBtn);
            eventActions.appendChild(deleteBtn);
            
            eventElement.appendChild(eventTitle);
            eventElement.appendChild(eventDetails);
            eventElement.appendChild(eventActions);
            
            eventElement.addEventListener('click', () => {
              editEvent(event.id);
            });
            
            eventsContainer.appendChild(eventElement);
          });
          
          dayElement.appendChild(eventsContainer);
          calendarBody.appendChild(dayElement);
        }
      }

      function getEventsForDay(date) {
        return events.filter(event => isSameDay(parseDate(event.date), date));
      }

      function openModal(event = null) {
        if (event) {
          modalTitle.textContent = 'Edit Event';
          eventIdInput.value = event.id;
          eventTitleInput.value = event.title;
          eventDescriptionInput.value = event.description;
          eventDateInput.value = event.date;
          eventTimeInput.value = event.time;
          eventLocationInput.value = event.location;
          deleteBtn.style.display = 'block';
        } else {
          modalTitle.textContent = 'Add New Event';
          eventIdInput.value = '';
          eventTitleInput.value = '';
          eventDescriptionInput.value = '';
          eventDateInput.value = formatDate(new Date());
          eventTimeInput.value = '09:00';
          eventLocationInput.value = '';
          deleteBtn.style.display = 'none';
        }
        eventModal.classList.add('active');
      }

      function closeModal() {
        eventModal.classList.remove('active');
      }

      function saveEvent() {
        const eventData = {
          id: eventIdInput.value || Date.now().toString(),
          title: eventTitleInput.value,
          description: eventDescriptionInput.value,
          date: eventDateInput.value,
          time: eventTimeInput.value,
          location: eventLocationInput.value,
          notified: false
        };

        if (eventIdInput.value) {
          // Update existing event
          events = events.map(event => event.id === eventIdInput.value ? eventData : event);
          showNotification('Event updated successfully', 'success');
        } else {
          // Add new event
          events.push(eventData);
          showNotification('Event added successfully', 'success');
        }

        localStorage.setItem('events', JSON.stringify(events));
        closeModal();
        renderCalendar();
        renderUpcomingEvents();
        updateChart();
      }

      function editEvent(id) {
        const event = events.find(event => event.id === id);
        if (event) {
          openModal(event);
        }
      }

      function deleteEvent(id = null) {
        const eventId = id || eventIdInput.value;
        if (!eventId) return;

        events = events.filter(event => event.id !== eventId);
        localStorage.setItem('events', JSON.stringify(events));
        closeModal();
        renderCalendar();
        renderUpcomingEvents();
        updateChart();
        showNotification('Event deleted successfully', 'success');
      }

      function toggleTheme() {
        if (document.body.classList.contains('dark')) {
          document.body.classList.remove('dark');
          localStorage.setItem('theme', 'light');
        } else {
          document.body.classList.add('dark');
          localStorage.setItem('theme', 'dark');
        }
      }

      function toggleSidebar() {
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
      }

      function checkThemePreference() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
          document.body.classList.add('dark');
        }
      }

      function renderUpcomingEvents() {
        upcomingEventsList.innerHTML = '';
        
        // Sort events by date
        const sortedEvents = [...events].sort((a, b) => {
          return new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time);
        });
        
        // Get upcoming events (future events only)
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const upcomingEvents = sortedEvents.filter(event => {
          const eventDate = parseDate(event.date);
          eventDate.setHours(0, 0, 0, 0);
          return eventDate >= today;
        });
        
        if (upcomingEvents.length === 0) {
          const emptyMessage = document.createElement('p');
          emptyMessage.textContent = 'No upcoming events scheduled.';
          emptyMessage.style.color = 'hsl(var(--muted-foreground))';
          emptyMessage.style.fontSize = '0.875rem';
          upcomingEventsList.appendChild(emptyMessage);
          return;
        }
        
        upcomingEvents.forEach(event => {
          const eventElement = document.createElement('div');
          eventElement.className = 'upcoming-event';
          eventElement.dataset.id = event.id;
          
          const title = document.createElement('h3');
          title.textContent = event.title;
          
          const details = document.createElement('p');
          
          const dateIcon = document.createElement('span');
          dateIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>';
          
          const dateText = document.createElement('span');
          dateText.textContent = formatDisplayDate(event.date) + ' • ' + event.time;
          
          const locationIcon = document.createElement('span');
          locationIcon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>';
          
          const locationText = document.createElement('span');
          locationText.textContent = event.location;
          
          details.appendChild(dateIcon);
          details.appendChild(dateText);
          details.appendChild(document.createElement('br'));
          details.appendChild(locationIcon);
          details.appendChild(locationText);
          
          const deleteBtn = document.createElement('button');
          deleteBtn.className = 'btn-danger btn-sm';
          deleteBtn.style.marginTop = '0.5rem';
          deleteBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg> Delete';
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('Are you sure you want to delete this event?')) {
              deleteEvent(event.id);
            }
          });
          
          eventElement.appendChild(title);
          eventElement.appendChild(details);
          eventElement.appendChild(deleteBtn);
          upcomingEventsList.appendChild(eventElement);
        });
      }

      function initChart() {
        eventsChart = new Chart(eventsChartCtx, {
          type: 'bar',
          data: {
            labels: ['This Week', 'Next Week', 'Following Week'],
            datasets: [{
              label: 'Number of Events',
              data: [0, 0, 0],
              backgroundColor: 'hsl(var(--primary) / 0.8)',
              borderColor: 'hsl(var(--primary))',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  precision: 0
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        });
        
        updateChart();
      }

      function updateChart() {
        const today = new Date();
        const nextWeek = new Date();
        nextWeek.setDate(today.getDate() + 7);
        const twoWeeksLater = new Date();
        twoWeeksLater.setDate(today.getDate() + 14);
        
        const thisWeekCount = events.filter(event => {
          const eventDate = parseDate(event.date);
          return eventDate >= today && eventDate < nextWeek;
        }).length;
        
        const nextWeekCount = events.filter(event => {
          const eventDate = parseDate(event.date);
          return eventDate >= nextWeek && eventDate < twoWeeksLater;
        }).length;
        
        const followingWeekCount = events.filter(event => {
          const eventDate = parseDate(event.date);
          return eventDate >= twoWeeksLater;
        }).length;
        
        eventsChart.data.datasets[0].data = [thisWeekCount, nextWeekCount, followingWeekCount];
        eventsChart.update();
      }

      function startNotificationChecker() {
        // Clear any existing interval
        if (notificationCheckInterval) {
          clearInterval(notificationCheckInterval);
        }
        
        // Check for events every minute
        notificationCheckInterval = setInterval(() => {
          checkForUpcomingEvents();
        }, 60000); // 1 minute
        
        // Also check immediately when the page loads
        checkForUpcomingEvents();
      }

      function checkForUpcomingEvents() {
        const now = new Date();
        const notificationTime = 15; // minutes before event to notify
        
        events.forEach(event => {
          if (event.notified) return; // Skip if already notified
          
          const eventDateTime = new Date(`${event.date}T${event.time}`);
          const timeDiff = (eventDateTime - now) / (1000 * 60); // difference in minutes
          
          if (timeDiff > 0 && timeDiff <= notificationTime) {
            // Time to notify!
            showEventReminder(event);
            event.notified = true;
            localStorage.setItem('events', JSON.stringify(events));
          }
        });
      }

      function showEventReminder(event) {
        const notification = document.createElement('div');
        notification.className = 'notification reminder show';
        
        const icon = document.createElement('div');
        icon.className = 'notification-icon';
        icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>';
        
        const content = document.createElement('div');
        content.className = 'notification-content';
        
        const title = document.createElement('div');
        title.className = 'notification-title';
        title.textContent = 'Upcoming Event';
        
        const msg = document.createElement('div');
        msg.className = 'notification-message';
        msg.textContent = `${event.title} starts at ${event.time} in ${event.location}`;
        
        const actions = document.createElement('div');
        actions.className = 'notification-actions';
        
        const snoozeBtn = document.createElement('button');
        snoozeBtn.className = 'btn-outline btn-sm';
        snoozeBtn.textContent = 'Snooze (5 min)';
        snoozeBtn.addEventListener('click', () => {
          notification.remove();
          // Reset notified status so it will trigger again in 5 minutes
          setTimeout(() => {
            const eventIndex = events.findIndex(e => e.id === event.id);
            if (eventIndex !== -1) {
              events[eventIndex].notified = false;
              localStorage.setItem('events', JSON.stringify(events));
            }
          }, 5 * 60 * 1000); // 5 minutes
        });
        
        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn-primary btn-sm';
        closeBtn.textContent = 'Dismiss';
        closeBtn.addEventListener('click', () => {
          notification.remove();
        });
        
        actions.appendChild(snoozeBtn);
        actions.appendChild(closeBtn);
        
        content.appendChild(title);
        content.appendChild(msg);
        content.appendChild(actions);
        
        const notificationClose = document.createElement('button');
        notificationClose.className = 'notification-close';
        notificationClose.innerHTML = '&times;';
        notificationClose.addEventListener('click', () => {
          notification.remove();
        });
        
        notification.appendChild(icon);
        notification.appendChild(content);
        notification.appendChild(notificationClose);
        
        notificationContainer.appendChild(notification);
        
        // Play notification sound
        notificationSound.play().catch(e => console.log('Audio playback failed:', e));
        
        // Don't auto-dismiss reminder notifications
      }

      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type} show`;
        
        const icon = document.createElement('div');
        icon.className = 'notification-icon';
        
        if (type === 'success') {
          icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>';
        } else if (type === 'error') {
          icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>';
        } else {
          icon.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>';
        }
        
        const content = document.createElement('div');
        content.className = 'notification-content';
        
        const title = document.createElement('div');
        title.className = 'notification-title';
        title.textContent = type === 'success' ? 'Success' : type === 'error' ? 'Error' : 'Info';
        
        const msg = document.createElement('div');
        msg.className = 'notification-message';
        msg.textContent = message;
        
        content.appendChild(title);
        content.appendChild(msg);
        
        const closeBtn = document.createElement('button');
        closeBtn.className = 'notification-close';
        closeBtn.innerHTML = '&times;';
        closeBtn.addEventListener('click', () => {
          notification.remove();
        });
        
        notification.appendChild(icon);
        notification.appendChild(content);
        notification.appendChild(closeBtn);
        
        notificationContainer.appendChild(notification);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
          notification.classList.remove('show');
          setTimeout(() => {
            notification.remove();
          }, 300);
        }, 5000);
      }

      // Helper functions
      function isSameDay(date1, date2) {
        return date1.getFullYear() === date2.getFullYear() &&
               date1.getMonth() === date2.getMonth() &&
               date1.getDate() === date2.getDate();
      }

      function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
      }

      function formatDisplayDate(dateString) {
        const date = parseDate(dateString);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      }

      function parseDate(dateString) {
        const parts = dateString.split('-');
        return new Date(parts[0], parts[1] - 1, parts[2]);
      }
    });
  </script>
</body>
</html>